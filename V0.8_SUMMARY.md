# ddl-69 v0.8 Summary

## What's New in v0.8

v0.8 merges the **real API layer from v0.7** with the **enhanced UI from v6.2**, creating a production-ready probability engine with both static and real-time modes.

---

## Architecture

### Backend (from v0.7)
- **Serverless APIs** (`api/` folder):
  - `/api/forecasts` - queries `v_latest_ensemble_forecasts` from Supabase
  - `/api/events` - event metadata
  - `/api/status` - system health
  - `/api/calibration` - calibration metrics
- **Fallback mode**: returns deterministic sample data if Supabase not configured
- **Python 3.9** runtime on Vercel

### Frontend (from v6.2 + enhancements)
- **Dual mode UI**:
  - **Static JSON mode** (default): load from Supabase storage URLs
  - **API mode** (real-time): call `/api/forecasts` for live data
- **All v6.2 UI features**:
  - Watchlist filter/sort/dense/compact/grid/table
  - Probability gauge, score pulse
  - Engine breakdown with QLIB vs Sentiment comparison
  - Weights panel with filters + stats
  - Overlay chart (zones/lines/levels/percent/markers)
  - Walk-forward panel
  - News with source domains
  - Data status + last refresh
  - Export to JSON/CSV

---

## Key Files

### Configuration
- `vercel.json` - routes API + UI
- `.env` - Supabase credentials

### APIs
- `api/forecasts.py` - main forecasts endpoint
- `api/events.py` - event metadata
- `api/status.py` - health check
- `api/calibration.py` - calibration data

### UI
- `ui/index.html` - main page
- `ui/app.js` - all UI logic + API calls
- `ui/styles.css` - styling

### Backend
- `src/ddl69/` - core engine (experts, signals, weights)
- `sql/` - Supabase schema

---

## How It Works

### Static JSON Mode (Default)
1. User pastes Supabase storage URLs in UI
2. UI fetches JSON files directly
3. Renders watchlist/news/overlays
4. No server-side queries

### API Mode (Real-Time)
1. User enables "Use Real API" checkbox
2. UI calls `/api/forecasts`
3. API queries Supabase `v_latest_ensemble_forecasts` view
4. Joins with `events` table for ticker/metadata
5. Returns JSON with forecasts
6. UI renders live data
7. Fallback to sample data if DB error

---

## Deployment

### Vercel Setup
1. Connect GitHub repo
2. Set environment variables:
   ```
   SUPABASE_URL=https://xxx.supabase.co
   SUPABASE_SERVICE_ROLE_KEY=xxx
   ```
3. Deploy
4. API functions auto-deploy to `/api/*`
5. UI serves from `/`

### Vercel Config (`vercel.json`)
```json
{
  "version": 2,
  "functions": {
    "api/**/*.py": {
      "runtime": "python3.9"
    }
  },
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/ui/index.html"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "/api/$1"
    }
  ]
}
```

---

## What Makes It "Real" (vs v6.2)

### v6.2 (Fake/Static)
- ❌ No API layer
- ❌ Static JSON URLs only
- ❌ No database queries
- ❌ Just displays whatever JSON you paste
- ❌ Not connected to live data

### v0.8 (Real)
- ✅ Serverless API endpoints
- ✅ Queries Supabase live
- ✅ Real-time ensemble forecasts
- ✅ Fallback to sample data
- ✅ Both static and API modes
- ✅ Production-ready

---

## Comparison Matrix

| Feature | v0.7 | v6.2 | v0.8 |
|---------|------|------|------|
| Real APIs | ✅ | ❌ | ✅ |
| Static JSON mode | ❌ | ✅ | ✅ |
| Filter/sort | ❌ | ✅ | ✅ |
| Dense/compact | ❌ | ✅ | ✅ |
| Grid/table view | ❌ | ✅ | ✅ |
| Overlay chart | ❌ | ✅ | ✅ |
| Walk-forward panel | ❌ | ✅ | ✅ |
| Engine breakdown | ❌ | ✅ | ✅ |
| QLIB vs Sentiment | ❌ | ✅ | ✅ |
| Export JSON/CSV | ❌ | ✅ | ✅ |
| Auto-refresh | ❌ | ✅ | ✅ |
| Supabase queries | ✅ | ❌ | ✅ |
| Fallback sample data | ✅ | ❌ | ✅ |

---

## Next Steps

1. Deploy to Vercel
2. Set Supabase env vars
3. Test API mode vs static mode
4. Add more API endpoints (news, overlays, walk-forward)
5. Add authentication (optional)

---

## Notes

- **Not pushed to GitHub yet** (per user request)
- **Vercel quota**: user at 80%, deployments paused
- **Location**: `C:\Users\Stas\Downloads\ddl-69_v0.8`
- **Base**: merged v0.7 (APIs) + v6.2 (UI)
- **Status**: ready for testing
