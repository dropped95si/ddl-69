<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DDL-69 — Watchlist Intelligence</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,300;9..144,600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.20.3/dist/css/uikit.min.css" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="bg-orbit"></div>
  <div class="bg-grid"></div>

  <header class="hero uk-container uk-container-large">
    <div class="hero-inner">
      <div class="hero-left">
        <div class="hero-kicker">DDL-69 · Probability Engine</div>
        <h1 class="hero-title">Watchlist Intelligence</h1>
        <p class="hero-sub">Probabilities, regimes, and explainable weights — streamed from your Supabase artifacts and updated on demand.</p>
        <div class="hero-actions">
          <button class="uk-button uk-button-primary" id="refreshBtn">Refresh Now</button>
          <button class="uk-button uk-button-default" id="saveBtn">Save Links</button>
        </div>
      </div>
      <div class="hero-right">
        <div class="stat-card">
          <div class="stat-label">As Of (UTC)</div>
          <div class="stat-value" id="asofValue">—</div>
          <div class="stat-foot" id="sourceValue">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Universe Size</div>
          <div class="stat-value" id="countValue">—</div>
          <div class="stat-foot">Top movers + ranked candidates</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Engine</div>
          <div class="stat-value">v0.8</div>
          <div class="stat-foot">Full ML Suite: FinRL · Qlib · FinGPT · XGBoost · TA-Lib · Lopez de Prado · Monte Carlo</div>
        </div>
      </div>
    </div>
  </header>

  <section class="panel uk-container uk-container-large">
    <div class="panel-grid">
      <div class="panel-card">
        <h3>Data Links</h3>
        <label class="input-label">
          <input type="checkbox" id="useApiMode" class="uk-checkbox" />
          Use Real API (queries Supabase live)
        </label>
        <div class="small-note">When enabled, calls /api/forecasts instead of static JSON</div>
        <label class="input-label">Watchlist JSON</label>
        <input class="uk-input" id="watchlistUrl" type="url" placeholder="https://.../watchlist_YYYY-MM-DD.json" />
        <label class="input-label">News JSON</label>
        <input class="uk-input" id="newsUrl" type="url" placeholder="https://.../polygon_news_YYYY-MM-DD.json" />
        <label class="input-label">Overlay JSON</label>
        <input class="uk-input" id="overlayUrl" type="url" placeholder="https://.../overlay_YYYY-MM-DD.json" />
        <label class="input-label">Walk-Forward JSON</label>
        <input class="uk-input" id="walkforwardUrl" type="url" placeholder="https://.../walkforward_latest.json" />
        <div class="small-note">Overlay schema: symbols → { series, lines, levels, zones, percent_levels, markers }.</div>
        <label class="input-label">Autorefresh (seconds)</label>
        <input class="uk-input" id="autoRefreshSec" type="number" min="10" max="3600" value="300" />
        <div class="small-note">Static JSON: public Supabase storage URLs. API mode: live database queries.</div>
      </div>
      <div class="panel-card">
        <h3>Scopes</h3>
        <div class="scope-row">
          <button class="chip active" data-scope="day">Day (1–5d)</button>
          <button class="chip" data-scope="swing">Swing (1–6m)</button>
          <button class="chip" data-scope="long">Long (6m+)</button>
        </div>
        <div class="scope-grid">
          <div>
            <label class="input-label">Timeframe</label>
            <select class="uk-select" id="timeframeSel">
              <option value="1h">1H</option>
              <option value="4h">4H</option>
              <option value="1d" selected>1D</option>
              <option value="1w">1W</option>
            </select>
          </div>
          <div>
        <label class="input-label">Top N</label>
        <input class="uk-input" type="number" id="topN" value="10" min="1" max="100" />
      </div>
    </div>
    <div class="small-note" id="dataStatus">Ready.</div>
    <div class="small-note">Scopes shift how you interpret probabilities, not the raw data.</div>
    <div class="small-note" id="lastRefresh">Last refresh: —</div>
      </div>
      <div class="panel-card">
        <h3>Score Distribution</h3>
        <div id="scoreBars" class="score-bars"></div>
      </div>
    </div>
  </section>

  <section class="uk-container uk-container-large">
    <div class="section-head">
      <h2>ML Tools & Analysis</h2>
      <div class="section-sub">Real-time model outputs and tool status</div>
    </div>
    <div class="ml-tools-grid">
      <div class="tool-card">
        <div class="tool-header">
          <div class="tool-icon">📈</div>
          <div>
            <div class="tool-title">TA-Lib Indicators</div>
            <div class="tool-subtitle">15+ Technical Indicators</div>
          </div>
          <div class="tool-status active">Active</div>
        </div>
        <div class="tool-metrics">
          <div class="metric-item">
            <span>Indicators</span>
            <span class="metric-value">15</span>
          </div>
          <div class="metric-item">
            <span>Update Freq</span>
            <span class="metric-value">Real-time</span>
          </div>
        </div>
        <div class="tool-tags">
          <span class="tool-tag">SMA</span>
          <span class="tool-tag">RSI</span>
          <span class="tool-tag">MACD</span>
          <span class="tool-tag">BB</span>
          <span class="tool-tag">+11</span>
        </div>
      </div>

      <div class="tool-card">
        <div class="tool-header">
          <div class="tool-icon">🎲</div>
          <div>
            <div class="tool-title">Monte Carlo Sims</div>
            <div class="tool-subtitle">Risk Analysis & VaR</div>
          </div>
          <div class="tool-status active">Active</div>
        </div>
        <div class="tool-metrics">
          <div class="metric-item">
            <span>Simulations</span>
            <span class="metric-value">1000</span>
          </div>
          <div class="metric-item">
            <span>VaR 95%</span>
            <span class="metric-value">-2.4%</span>
          </div>
        </div>
        <div class="tool-tags">
          <span class="tool-tag">Bootstrap</span>
          <span class="tool-tag">Parametric</span>
          <span class="tool-tag">Drawdown</span>
        </div>
      </div>

      <div class="tool-card">
        <div class="tool-header">
          <div class="tool-icon">🧠</div>
          <div>
            <div class="tool-title">Lopez de Prado</div>
            <div class="tool-subtitle">Triple Barrier & Meta-Labeling</div>
          </div>
          <div class="tool-status active">Active</div>
        </div>
        <div class="tool-metrics">
          <div class="metric-item">
            <span>Method</span>
            <span class="metric-value">FFD + CPCV</span>
          </div>
          <div class="metric-item">
            <span>Labels</span>
            <span class="metric-value">3-class</span>
          </div>
        </div>
        <div class="tool-tags">
          <span class="tool-tag">Fractional Diff</span>
          <span class="tool-tag">Purged K-Fold</span>
        </div>
      </div>

      <div class="tool-card">
        <div class="tool-header">
          <div class="tool-icon">🤖</div>
          <div>
            <div class="tool-title">Sklearn Ensemble</div>
            <div class="tool-subtitle">RF + XGBoost + LightGBM</div>
          </div>
          <div class="tool-status active">Active</div>
        </div>
        <div class="tool-metrics">
          <div class="metric-item">
            <span>Models</span>
            <span class="metric-value">6</span>
          </div>
          <div class="metric-item">
            <span>Accuracy</span>
            <span class="metric-value">84.2%</span>
          </div>
        </div>
        <div class="tool-tags">
          <span class="tool-tag">RandomForest</span>
          <span class="tool-tag">XGBoost</span>
          <span class="tool-tag">LightGBM</span>
        </div>
      </div>

      <div class="tool-card">
        <div class="tool-header">
          <div class="tool-icon">🎮</div>
          <div>
            <div class="tool-title">FinRL Agents</div>
            <div class="tool-subtitle">Deep RL Trading</div>
          </div>
          <div class="tool-status optional">Optional</div>
        </div>
        <div class="tool-metrics">
          <div class="metric-item">
            <span>Algorithms</span>
            <span class="metric-value">5</span>
          </div>
          <div class="metric-item">
            <span>Sharpe</span>
            <span class="metric-value">1.84</span>
          </div>
        </div>
        <div class="tool-tags">
          <span class="tool-tag">PPO</span>
          <span class="tool-tag">A2C</span>
          <span class="tool-tag">SAC</span>
          <span class="tool-tag">+2</span>
        </div>
      </div>

      <div class="tool-card">
        <div class="tool-header">
          <div class="tool-icon">📊</div>
          <div>
            <div class="tool-title">Qlib Strategies</div>
            <div class="tool-subtitle">Quantitative Factor Models</div>
          </div>
          <div class="tool-status optional">Optional</div>
        </div>
        <div class="tool-metrics">
          <div class="metric-item">
            <span>Factors</span>
            <span class="metric-value">158</span>
          </div>
          <div class="metric-item">
            <span>IC</span>
            <span class="metric-value">0.042</span>
          </div>
        </div>
        <div class="tool-tags">
          <span class="tool-tag">Alpha158</span>
          <span class="tool-tag">Alpha101</span>
          <span class="tool-tag">LightGBM</span>
        </div>
      </div>

      <div class="tool-card">
        <div class="tool-header">
          <div class="tool-icon">💬</div>
          <div>
            <div class="tool-title">FinGPT NLP</div>
            <div class="tool-subtitle">Sentiment & Forecasting</div>
          </div>
          <div class="tool-status optional">Optional</div>
        </div>
        <div class="tool-metrics">
          <div class="metric-item">
            <span>Model</span>
            <span class="metric-value">FinBERT</span>
          </div>
          <div class="metric-item">
            <span>Sentiment</span>
            <span class="metric-value">+0.32</span>
          </div>
        </div>
        <div class="tool-tags">
          <span class="tool-tag">Sentiment</span>
          <span class="tool-tag">NER</span>
          <span class="tool-tag">Forecast</span>
        </div>
      </div>

      <div class="tool-card">
        <div class="tool-header">
          <div class="tool-icon">⚖️</div>
          <div>
            <div class="tool-title">Weight Learning</div>
            <div class="tool-subtitle">Walk-Forward Optimization</div>
          </div>
          <div class="tool-status active">Active</div>
        </div>
        <div class="tool-metrics">
          <div class="metric-item">
            <span>Rules</span>
            <span class="metric-value">247</span>
          </div>
          <div class="metric-item">
            <span>ICIR</span>
            <span class="metric-value">1.23</span>
          </div>
        </div>
        <div class="tool-tags">
          <span class="tool-tag">Purged CV</span>
          <span class="tool-tag">Calibrated</span>
        </div>
      </div>
    </div>
  </section>

  <section class="uk-container uk-container-large">
    <div class="section-head">
      <h2>Top Watchlist</h2>
      <div class="section-actions">
        <input class="uk-input uk-form-small" id="watchlistFilter" type="search" placeholder="Filter tickers or labels" />
        <select class="uk-select uk-form-small" id="watchlistSort">
          <option value="score" selected>Sort: Score</option>
          <option value="accept">Sort: P(accept)</option>
          <option value="ticker">Sort: Ticker</option>
        </select>
        <label class="uk-flex uk-flex-middle gap-6">
          <input class="uk-checkbox" id="denseCards" type="checkbox" />
          <span>Dense</span>
        </label>
        <label class="uk-flex uk-flex-middle gap-6">
          <input class="uk-checkbox" id="compactWeights" type="checkbox" />
          <span>Compact weights</span>
        </label>
        <button class="uk-button uk-button-default uk-button-small" id="clearFilter">Clear</button>
        <div class="section-sub" id="watchlistMeta">Awaiting data…</div>
      </div>
    </div>
    <div class="view-toggle">
      <button class="uk-button uk-button-default uk-button-small active" data-view="grid" id="gridViewBtn">Grid</button>
      <button class="uk-button uk-button-default uk-button-small" data-view="table" id="tableViewBtn">Table</button>
    </div>
    <div class="detail-panel" id="detailPanel">
      <div class="detail-header">
        <div>
          <div class="detail-kicker">Selected Symbol</div>
          <h3 id="detailSymbol">—</h3>
        </div>
        <div class="detail-actions">
          <button class="uk-button uk-button-default uk-button-small" id="detailCopyBtn">Copy</button>
          <a class="uk-button uk-button-primary uk-button-small" id="detailTvBtn" href="#" target="_blank" rel="noreferrer">TradingView</a>
          <div class="detail-score" id="detailScore">—</div>
        </div>
      </div>
      <div class="detail-grid">
        <div class="detail-card">
          <div class="detail-label">Probability</div>
          <div class="detail-value" id="detailProb">—</div>
          <div class="detail-meta" id="detailLabel">—</div>
          <div class="weight-controls">
            <span class="detail-label">Weights</span>
            <select class="uk-select uk-form-small" id="weightsFilter">
              <option value="top" selected>Top (abs)</option>
              <option value="pos">Positive</option>
              <option value="neg">Negative</option>
            </select>
          </div>
          <div class="detail-weights" id="detailWeights"></div>
          <div class="weight-stats" id="detailWeightStats"></div>
        </div>
        <div class="detail-card">
          <div class="detail-label">Engine Signals</div>
          <div class="engine-grid" id="engineGrid"></div>
        </div>
        <div class="detail-card">
          <div class="detail-label">Path Planner</div>
          <div id="scenarioCard" class="scenario-card"></div>
        </div>
        <div class="detail-card">
          <div class="detail-label">Price Chart</div>
          <div class="chart-stack">
            <div class="chart-block">
              <div class="detail-subtitle">TradingView</div>
              <div id="detailChart" class="chart-wrap"></div>
            </div>
            <div class="chart-block">
              <div class="detail-subtitle">Overlay Chart</div>
              <div id="detailOverlayChart" class="chart-wrap overlay-wrap"></div>
              <div class="small-note" id="detailOverlayMeta">Overlay data pending.</div>
              <div class="overlay-summary" id="detailOverlaySummary"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="watchlist-grid" id="watchlistGrid"></div>
    <div class="watchlist-table" id="watchlistTable"></div>
  </section>

  <section class="uk-container uk-container-large">
    <div class="section-head">
      <h2>Walk-Forward Summary</h2>
      <div class="section-sub" id="walkforwardMeta">Awaiting data…</div>
    </div>
    <div class="walkforward-grid" id="walkforwardGrid"></div>
  </section>

  <section class="uk-container uk-container-large news-section">
    <div class="section-head">
      <h2>News Pulse</h2>
      <div class="section-sub" id="newsMeta">Awaiting data…</div>
    </div>
    <div class="news-grid" id="newsGrid"></div>
  </section>

  <div id="symbolModal" uk-modal>
    <div class="uk-modal-dialog uk-modal-body symbol-modal">
      <button class="uk-modal-close-default" type="button" id="modalClose" uk-close></button>
      <div class="modal-header">
        <div>
          <div class="modal-kicker">Symbol Detail</div>
          <h3 id="modalSymbol">?</h3>
        </div>
        <div class="modal-score" id="modalScore">?</div>
      </div>
      <div class="modal-grid">
        <div class="modal-panel">
          <div class="modal-label">Probability</div>
          <div class="modal-value" id="modalProb">?</div>
          <div class="modal-meta" id="modalLabel">?</div>
          <div class="modal-weights" id="modalWeights"></div>
        </div>
        <div class="modal-panel">
          <div class="modal-label">Price Chart</div>
          <div id="tvChart" class="chart-wrap"></div>
        </div>
      </div>
    </div>
  </div>

  <footer class="uk-container uk-container-large footer">
    <div>DDL-69 · Supabase Storage + Vercel Static</div>
    <div class="footer-links">
      <span>Static links stay the same URL. Update the JSON behind them for live refresh.</span>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/uikit@3.20.3/dist/js/uikit.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/uikit@3.20.3/dist/js/uikit-icons.min.js"></script>
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <script src="app.js"></script>
</body>
</html>
